<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>blog.weininger.net - Samsung TV</title>
        <link rel="stylesheet" href="https://blog.weininger.net/theme/css/main.css" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="https://blog.weininger.net/">blog.weininger.net</a></h1>
                <nav><ul>
                    <li><a href="https://blog.weininger.net/category/free-software.html">Free Software</a></li>
                </ul></nav>
        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="https://blog.weininger.net/streaming-video-files-to-samsung-tvs-part-2.html">Streaming video files to Samsung TVs (Part 2)</a></h1>
<footer class="post-info">
        <abbr class="published" title="2012-06-15T20:49:00+02:00">
                Published: Fr 15 Juni 2012
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://blog.weininger.net/author/thomas-weininger.html">Thomas Weininger</a>
        </address>
<p>In <a href="https://blog.weininger.net/category/free-software.html">Free Software</a>.</p>
<p>tags: <a href="https://blog.weininger.net/tag/dlna.html">DLNA</a> <a href="https://blog.weininger.net/tag/linux.html">Linux</a> <a href="https://blog.weininger.net/tag/ruby.html">Ruby</a> <a href="https://blog.weininger.net/tag/samsung-tv.html">Samsung TV</a> </p>
</footer><!-- /.post-info --><p>The second (and final) part of my article series about streaming video
files to Samsung TVs describes which video and audio codecs as well as
which container formats to choose for playing back video files on
Samsung devices (tested with UE40D6200). Furthermore I'll show you a
Ruby program I wrote for transcoding files automatically to the right
format.</p>
<p>I have many files like Flash video files from YouTube, recorded MPEG2
transport streams from my PVR and other media files my TV doesn't
understand or doesn't support very well. Unfortunately, many of them
must be transcoded to another format which is more suitable for the TVs
DLNA function. To find the best formats for the conversation I've
started a series of tests. I took a video file and transcoded it using
many different video and audio codecs and container formats and checked
their compatibility with Samsungs SmartHub. To keep this article short,
I show you only the summary of my tests instead of the full results. In
short that is:</p>
<p>Video codecs that don't need to be converted:</p>
<ul class="simple">
<li>H264</li>
<li>MPEG4</li>
<li>WMV3</li>
</ul>
<p>Audio codecs that don't need to be converted:</p>
<ul class="simple">
<li>MP3</li>
<li>AAC</li>
<li>AC3</li>
</ul>
<p>My investigation showed that both the Matroska (.mkv) and the MPEG4
(.mp4) container formats are most suiteable for my scenario.</p>
<p>Above stated rules are simplified as there are also other constraints to
consider when trying to make ones video collection ready for streaming.
I wrote a sweet little Ruby program that is much more sophisticated and
takes care of most codecs and handles them the right way automatically.
It scans given paths or single video files and converts them if
necessary. One goal while designing the tool was to keep the original
quality of the files whenever possible. To achieve this it handles the
audio and video stream of the file independently from each other and
transcodes only those parts that need to be converted. So for instance
if the video stream needs to be converted, but the audio stream does
not, it only changes the video stream and takes the audio track from the
original file.</p>
<p>My program depends on FFMPEG and the Ruby package <a class="reference external" href="https://github.com/streamio/streamio-ffmpeg">streamio-ffmpeg</a>.
You can install it using gem via:</p>
<pre class="code text literal-block">
(sudo) gem install streamio-ffmpeg
</pre>
<p>It's also important that your FFMPEG installation supports libfaac
encoding. To check this simply type &quot;ffmpeg&quot; in your terminal. If there
is a line &quot;libfaac&quot; with an &quot;E&quot; in one of the columns before the codec
name, then everything is fine.</p>
<p>I think the code is pretty selfexplaining. It's far from perfect, but in
practice it works very well. Usage is simple:</p>
<pre class="code text literal-block">
ffautoconv.rb &lt;file(s)/path(s) to scan&gt;
</pre>
<p>It writes a logfile to /tmp/ffautoconv.log while running so it's
possible to reconstruct what the program was doing.</p>
<p>Please leave a comment if you have a suggestion or simply found my
program useful. Here's the download link: <a class="reference external" href="http://weininger.net/wp-content/uploads/2012/06/ffautoconv.gz">ffautoconv</a>.</p>
<pre class="code ruby literal-block">
<span class="ch">#!/usr/bin/env ruby</span><span class="w">
</span><span class="c1"># ffautoconv.rb: Program for transcoding videos for streaming them to Samsung TVs.</span><span class="w">
</span><span class="c1"># Author: Thomas Weininger (http://blog.weinimo.de)</span><span class="w">
</span><span class="c1"># This program is free software: you can redistribute it and/or modify it under the terms of the BSD license.</span><span class="w">

</span><span class="nb">require</span><span class="w"> </span><span class="s1">'find'</span><span class="w">
</span><span class="nb">require</span><span class="w"> </span><span class="s1">'rubygems'</span><span class="w">
</span><span class="nb">require</span><span class="w"> </span><span class="s1">'streamio-ffmpeg'</span><span class="w">

</span><span class="k">def</span><span class="w"> </span><span class="nf">containerChange</span><span class="w"> </span><span class="p">(</span><span class="n">movie</span><span class="p">,</span><span class="w"> </span><span class="n">filename</span><span class="p">,</span><span class="w"> </span><span class="n">container</span><span class="p">)</span><span class="w">
  </span><span class="k">if</span><span class="w"> </span><span class="no">File</span><span class="o">.</span><span class="n">extname</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s2">&quot;.&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">container</span><span class="w">
    </span><span class="vg">$logfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;New container of  </span><span class="si">#{</span><span class="n">filename</span><span class="si">}</span><span class="s2"> will be: </span><span class="si">#{</span><span class="n">container</span><span class="si">}</span><span class="s2">.
     </span><span class="se">\n</span><span class="s2">  Original file: </span><span class="si">#{</span><span class="n">movie</span><span class="o">.</span><span class="n">video_codec</span><span class="si">}</span><span class="s2">, acodec: </span><span class="si">#{</span><span class="n">movie</span><span class="o">.</span><span class="n">audio_codec</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span><span class="w">
    </span><span class="n">newfilename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">filename</span><span class="o">.</span><span class="n">chomp</span><span class="p">(</span><span class="no">File</span><span class="o">.</span><span class="n">extname</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot;.</span><span class="si">#{</span><span class="n">container</span><span class="si">}</span><span class="s2">&quot;</span><span class="w">
    </span><span class="n">movie</span><span class="o">.</span><span class="n">transcode</span><span class="p">(</span><span class="n">newfilename</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;-vcodec copy -acodec copy -copyts&quot;</span><span class="p">)</span><span class="w">

    </span><span class="c1"># Check whether container change was successful.</span><span class="w">
    </span><span class="n">newmovie</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">FFMPEG</span><span class="o">::</span><span class="no">Movie</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">newfilename</span><span class="p">)</span><span class="w">
    </span><span class="k">if</span><span class="w"> </span><span class="n">newmovie</span><span class="o">.</span><span class="n">valid?</span><span class="w">
      </span><span class="vg">$logfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  Container format changed successfully. Deleting &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">filename</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot;.</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span><span class="w">
      </span><span class="no">File</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="w">
    </span><span class="k">else</span><span class="w">
      </span><span class="vg">$logfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  Error occured while trying to change the container format. Deleting &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">newfilename</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot;.</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span><span class="w">
      </span><span class="no">File</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">newfilename</span><span class="p">)</span><span class="w">
    </span><span class="k">end</span><span class="w">
  </span><span class="k">else</span><span class="w">
    </span><span class="vg">$logfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Container of &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">filename</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; doesn't have to be changed&quot;</span><span class="w"> </span><span class="o">+</span><span class="w">
      </span><span class="s2">&quot;.</span><span class="se">\n</span><span class="s2">  Original file: </span><span class="si">#{</span><span class="n">movie</span><span class="o">.</span><span class="n">video_codec</span><span class="si">}</span><span class="s2">, acodec: </span><span class="si">#{</span><span class="n">movie</span><span class="o">.</span><span class="n">audio_codec</span><span class="si">}</span><span class="s2">.</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span><span class="w">
  </span><span class="k">end</span><span class="w">
</span><span class="k">end</span><span class="w">

</span><span class="k">def</span><span class="w"> </span><span class="nf">reencode</span><span class="w"> </span><span class="p">(</span><span class="n">movie</span><span class="p">,</span><span class="w"> </span><span class="n">filename</span><span class="p">,</span><span class="w"> </span><span class="n">acodec</span><span class="p">,</span><span class="w"> </span><span class="n">vcodec</span><span class="p">,</span><span class="w"> </span><span class="n">container</span><span class="p">)</span><span class="w">
  </span><span class="c1"># Decide whether we need to transcode or only a container change.</span><span class="w">
  </span><span class="k">if</span><span class="w"> </span><span class="n">movie</span><span class="o">.</span><span class="n">audio_codec</span><span class="o">.</span><span class="n">nil?</span><span class="w">                                                     </span><span class="c1"># Prevent NoMethodError if no audio track is available.</span><span class="w">
    </span><span class="n">orig_acodec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="w">
  </span><span class="k">else</span><span class="w">
    </span><span class="n">orig_acodec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">movie</span><span class="o">.</span><span class="n">audio_codec</span><span class="w">
  </span><span class="k">end</span><span class="w">

  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">orig_acodec</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sr">/^</span><span class="si">#{</span><span class="n">acodec</span><span class="si">}</span><span class="sr">(.*)/</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">movie</span><span class="o">.</span><span class="n">video_codec</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sr">/^</span><span class="si">#{</span><span class="n">vcodec</span><span class="si">}</span><span class="sr">(.*)/</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w">
       </span><span class="p">(</span><span class="w"> </span><span class="n">acodec</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;copy&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">vcodec</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;copy&quot;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w">
    </span><span class="n">containerChange</span><span class="p">(</span><span class="n">movie</span><span class="p">,</span><span class="w"> </span><span class="n">filename</span><span class="p">,</span><span class="w"> </span><span class="n">container</span><span class="p">)</span><span class="w">
  </span><span class="k">else</span><span class="w">
    </span><span class="vg">$logfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;New Codecs of </span><span class="si">#{</span><span class="n">filename</span><span class="si">}</span><span class="s2"> will be: </span><span class="si">#{</span><span class="n">vcodec</span><span class="si">}</span><span class="s2">, </span><span class="si">#{</span><span class="n">acodec</span><span class="si">}</span><span class="s2">, </span><span class="si">#{</span><span class="n">container</span><span class="si">}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">+</span><span class="w">
      </span><span class="s2">&quot;  Original file: </span><span class="si">#{</span><span class="n">movie</span><span class="o">.</span><span class="n">video_codec</span><span class="si">}</span><span class="s2">, acodec: </span><span class="si">#{</span><span class="n">movie</span><span class="o">.</span><span class="n">audio_codec</span><span class="si">}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span><span class="w">
    </span><span class="vg">$logfile</span><span class="o">.</span><span class="n">flush</span><span class="w">
    </span><span class="n">newfilename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">filename</span><span class="o">.</span><span class="n">chomp</span><span class="p">(</span><span class="no">File</span><span class="o">.</span><span class="n">extname</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot;.</span><span class="si">#{</span><span class="n">container</span><span class="si">}</span><span class="s2">&quot;</span><span class="w">
    </span><span class="n">options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="ss">:threads</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">}</span><span class="w">
    </span><span class="n">customopts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="w">

    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">movie</span><span class="o">.</span><span class="n">video_codec</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sr">/^</span><span class="si">#{</span><span class="n">vcodec</span><span class="si">}</span><span class="sr">(.*)/</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">vcodec</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;copy&quot;</span><span class="w"> </span><span class="p">)</span><span class="w">        </span><span class="c1"># Can we use the video track from the original file?</span><span class="w">
      </span><span class="n">customopts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">customopts</span><span class="si">}</span><span class="s2"> -copyts&quot;</span><span class="w">
      </span><span class="n">options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">options</span><span class="o">.</span><span class="n">merge</span><span class="p">({</span><span class="w"> </span><span class="ss">:video_codec</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s2">&quot;copy&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">:custom</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">customopts</span><span class="w"> </span><span class="p">})</span><span class="w">
    </span><span class="k">else</span><span class="w">
      </span><span class="k">case</span><span class="w"> </span><span class="n">vcodec</span><span class="w">
      </span><span class="k">when</span><span class="w"> </span><span class="s2">&quot;h264&quot;</span><span class="w">
        </span><span class="n">customopts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">customopts</span><span class="si">}</span><span class="s2"> -qscale 0&quot;</span><span class="w">
        </span><span class="n">options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">options</span><span class="o">.</span><span class="n">merge</span><span class="p">({</span><span class="w"> </span><span class="ss">:video_codec</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s2">&quot;libx264&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">:custom</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">customopts</span><span class="w"> </span><span class="p">})</span><span class="w">
      </span><span class="k">end</span><span class="w">
    </span><span class="k">end</span><span class="w">

    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">orig_acodec</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sr">/^</span><span class="si">#{</span><span class="n">acodec</span><span class="si">}</span><span class="sr">(.*)/</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">acodec</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;copy&quot;</span><span class="w"> </span><span class="p">)</span><span class="w">        </span><span class="c1"># Can we use the audio track from the original file?</span><span class="w">
      </span><span class="n">options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">options</span><span class="o">.</span><span class="n">merge</span><span class="p">({</span><span class="w"> </span><span class="ss">:audio_codec</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s2">&quot;copy&quot;</span><span class="w"> </span><span class="p">})</span><span class="w">
    </span><span class="k">else</span><span class="w">
      </span><span class="k">case</span><span class="w"> </span><span class="n">acodec</span><span class="w">
      </span><span class="k">when</span><span class="w"> </span><span class="s2">&quot;aac&quot;</span><span class="w">
        </span><span class="n">customopts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">customopts</span><span class="si">}</span><span class="s2"> -aq 120&quot;</span><span class="w">
        </span><span class="n">options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">options</span><span class="o">.</span><span class="n">merge</span><span class="p">({</span><span class="w"> </span><span class="ss">:audio_codec</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s2">&quot;libfaac&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">:custom</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">customopts</span><span class="w"> </span><span class="p">})</span><span class="w">
      </span><span class="k">end</span><span class="w">
    </span><span class="k">end</span><span class="w">

    </span><span class="k">begin</span><span class="w">
      </span><span class="nb">puts</span><span class="w"> </span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Transcoding: </span><span class="si">#{</span><span class="n">filename</span><span class="si">}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="w">
      </span><span class="n">beginning_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">Time</span><span class="o">.</span><span class="n">now</span><span class="w">
      </span><span class="n">movie</span><span class="o">.</span><span class="n">transcode</span><span class="p">(</span><span class="n">newfilename</span><span class="p">,</span><span class="w"> </span><span class="n">options</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">|</span><span class="n">progress</span><span class="o">|</span><span class="w"> </span><span class="nb">print</span><span class="w"> </span><span class="s2">&quot;</span><span class="se">\r</span><span class="si">#{</span><span class="nb">Integer</span><span class="p">(</span><span class="n">progress</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span><span class="si">}</span><span class="s2">%&quot;</span><span class="w"> </span><span class="p">}</span><span class="w">
      </span><span class="n">total_secs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">Time</span><span class="o">.</span><span class="n">now</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">beginning_time</span><span class="w">
      </span><span class="n">combined_mins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">total_secs</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">60</span><span class="p">)</span><span class="o">.</span><span class="n">floor</span><span class="w">
      </span><span class="n">combined_secs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">total_secs</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">60</span><span class="p">)</span><span class="o">.</span><span class="n">floor</span><span class="w">
      </span><span class="vg">$logfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  Time elapsed: </span><span class="si">#{</span><span class="n">combined_mins</span><span class="si">}</span><span class="s2"> minutes, </span><span class="si">#{</span><span class="n">combined_secs</span><span class="si">}</span><span class="s2"> seconds (</span><span class="si">#{</span><span class="n">total_secs</span><span class="si">}</span><span class="s2"> seconds).</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span><span class="w">
    </span><span class="k">rescue</span><span class="w"> </span><span class="no">RuntimeError</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">e</span><span class="w">
      </span><span class="vg">$logfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  RUNTIME ERROR occured!!!</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span><span class="w">
      </span><span class="k">return</span><span class="w">
    </span><span class="k">rescue</span><span class="w"> </span><span class="no">Interrupt</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">e</span><span class="w">
      </span><span class="nb">puts</span><span class="w"> </span><span class="s2">&quot;SIGINT caught. Deleting </span><span class="si">#{</span><span class="n">newfilename</span><span class="si">}</span><span class="s2"> and exiting after that.&quot;</span><span class="w">
      </span><span class="no">File</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">newfilename</span><span class="p">)</span><span class="w">
      </span><span class="nb">exit</span><span class="w">
    </span><span class="k">end</span><span class="w">

    </span><span class="c1"># Check whether transcoding was successful.</span><span class="w">
    </span><span class="n">newmovie</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">FFMPEG</span><span class="o">::</span><span class="no">Movie</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">newfilename</span><span class="p">)</span><span class="w">
    </span><span class="k">if</span><span class="w"> </span><span class="n">newmovie</span><span class="o">.</span><span class="n">valid?</span><span class="w">
      </span><span class="vg">$logfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  Transcoding completed successfully. Deleting &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">filename</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot;.</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span><span class="w">
      </span><span class="no">File</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="w">
    </span><span class="k">else</span><span class="w">
      </span><span class="vg">$logfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  Error occured while transcoding. Deleting &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">newfilename</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot;.</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span><span class="w">
      </span><span class="no">File</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">newfilename</span><span class="p">)</span><span class="w">
    </span><span class="k">end</span><span class="w">
  </span><span class="k">end</span><span class="w">
</span><span class="k">end</span><span class="w">

</span><span class="vg">$logfile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">File</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;/tmp/ffautoconv.log&quot;</span><span class="p">,</span><span class="w"> </span><span class="no">File</span><span class="o">::</span><span class="no">WRONLY</span><span class="o">|</span><span class="no">File</span><span class="o">::</span><span class="no">TRUNC</span><span class="o">|</span><span class="no">File</span><span class="o">::</span><span class="no">CREAT</span><span class="o">|</span><span class="no">File</span><span class="o">::</span><span class="no">APPEND</span><span class="p">)</span><span class="w">
</span><span class="no">FFMPEG</span><span class="o">::</span><span class="n">logger</span><span class="o">.</span><span class="n">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">Logger</span><span class="o">::</span><span class="no">WARN</span><span class="w">

</span><span class="no">ARGV</span><span class="o">.</span><span class="n">each</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="o">|</span><span class="n">a</span><span class="o">|</span><span class="w">
  </span><span class="no">Find</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="o">|</span><span class="n">f</span><span class="o">|</span><span class="w">
    </span><span class="n">movie</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">FFMPEG</span><span class="o">::</span><span class="no">Movie</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="w">
    </span><span class="k">if</span><span class="w"> </span><span class="n">movie</span><span class="o">.</span><span class="n">valid?</span><span class="w">
      </span><span class="n">dstACodec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;copy&quot;</span><span class="w">                                                        </span><span class="c1"># Always use the old audio track.</span><span class="w">

      </span><span class="c1"># Decide new video codec depending on the video codec of the original file.</span><span class="w">
      </span><span class="k">case</span><span class="w"> </span><span class="n">movie</span><span class="o">.</span><span class="n">video_codec</span><span class="w">
      </span><span class="k">when</span><span class="w"> </span><span class="sr">/^h264(.*)/</span><span class="p">,</span><span class="w"> </span><span class="sr">/^mpeg4(.*)/</span><span class="p">,</span><span class="w"> </span><span class="sr">/^wmv3(.*)/</span><span class="w">                               </span><span class="c1"># Video codecs that don't need to be transcoded.</span><span class="w">
        </span><span class="n">dstVCodec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;copy&quot;</span><span class="w">
      </span><span class="k">when</span><span class="w"> </span><span class="sr">/^flv(.*)/</span><span class="p">,</span><span class="w"> </span><span class="sr">/^vp6f(.*)/</span><span class="p">,</span><span class="w"> </span><span class="sr">/^msmpeg4(.*)/</span><span class="p">,</span><span class="w"> </span><span class="sr">/^theora(.*)/</span><span class="p">,</span><span class="w">
           </span><span class="sr">/^wmv1(.*)/</span><span class="p">,</span><span class="w"> </span><span class="sr">/^wmv2(.*)/</span><span class="p">,</span><span class="w"> </span><span class="sr">/^vc1(.*)/</span><span class="p">,</span><span class="w"> </span><span class="sr">/^rv40(.*)/</span><span class="w">                    </span><span class="c1"># Video codecs that need to be transcoded.</span><span class="w">
        </span><span class="n">dstVCodec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;h264&quot;</span><span class="w">
      </span><span class="k">when</span><span class="w"> </span><span class="sr">/^mpeg2video(.*)/</span><span class="p">,</span><span class="w"> </span><span class="sr">/^mpeg1video(.*)/</span><span class="w">                                 </span><span class="c1"># MPEG videos need special treatment.</span><span class="w">
      </span><span class="k">when</span><span class="w"> </span><span class="sr">/^mjpeg(.*)/</span><span class="w">
        </span><span class="k">next</span><span class="w">
      </span><span class="k">else</span><span class="w">
        </span><span class="vg">$logfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">f</span><span class="si">}</span><span class="s2">: vcodec not handled: </span><span class="si">#{</span><span class="n">movie</span><span class="o">.</span><span class="n">video_codec</span><span class="si">}</span><span class="s2">, acodec: </span><span class="si">#{</span><span class="n">movie</span><span class="o">.</span><span class="n">audio_codec</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span><span class="w">
        </span><span class="k">next</span><span class="w">
      </span><span class="k">end</span><span class="w">

      </span><span class="c1"># Decide which container format we should take depending on the audio codec of the original file.</span><span class="w">
      </span><span class="k">case</span><span class="w"> </span><span class="n">movie</span><span class="o">.</span><span class="n">audio_codec</span><span class="w">
      </span><span class="k">when</span><span class="w"> </span><span class="kp">nil</span><span class="sc">?,</span><span class="w"> </span><span class="sr">/aac(.*)/</span><span class="p">,</span><span class="w"> </span><span class="sr">/mp3(.*)/</span><span class="p">,</span><span class="w"> </span><span class="sr">/ac3(.*)/</span><span class="w">                                </span><span class="c1"># ffmpeg mp4 does NOT support WMA, but wmv does. See http://en.wikipedia.org/wiki/Comparison_of_container_formats</span><span class="w">
        </span><span class="n">dstACodec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;aac&quot;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">movie</span><span class="o">.</span><span class="n">video_codec</span><span class="w"> </span><span class="o">=~</span> <span class="sr">/^vp6f(.*)/</span><span class="w">
        </span><span class="c1"># Change container for audio formats that are supported by the mp4 container.</span><span class="w">
        </span><span class="n">dstContainer</span><span class="w"> </span><span class="o">||=</span><span class="w"> </span><span class="s2">&quot;mp4&quot;</span><span class="w">
      </span><span class="k">when</span><span class="w"> </span><span class="sr">/cook(.*)/</span><span class="w">
        </span><span class="n">dstACodec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;aac&quot;</span><span class="w">
        </span><span class="n">dstContainer</span><span class="w"> </span><span class="o">||=</span><span class="w"> </span><span class="s2">&quot;mp4&quot;</span><span class="w">
      </span><span class="k">else</span><span class="w"> </span><span class="c1"># wmav2, sipr</span><span class="w">
        </span><span class="c1"># Matroska offers the best format support for all possible audio codecs.</span><span class="w">
        </span><span class="n">dstContainer</span><span class="w"> </span><span class="o">||=</span><span class="w"> </span><span class="s2">&quot;mkv&quot;</span><span class="w">
      </span><span class="k">end</span><span class="w">

      </span><span class="n">reencode</span><span class="p">(</span><span class="n">movie</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="n">dstACodec</span><span class="p">,</span><span class="w"> </span><span class="n">dstVCodec</span><span class="p">,</span><span class="w"> </span><span class="n">dstContainer</span><span class="p">)</span><span class="w">
      </span><span class="vg">$logfile</span><span class="o">.</span><span class="n">flush</span><span class="w">
    </span><span class="k">end</span><span class="w">
  </span><span class="k">end</span><span class="w">
</span><span class="k">end</span><span class="w">
</span><span class="vg">$logfile</span><span class="o">.</span><span class="n">close</span>
</pre>
<p>There are <a href="https://blog.weininger.net/streaming-video-files-to-samsung-tvs-part-2.html#disqus_thread">comments</a>.</p>                </article>
            </aside><!-- /#featured -->
                <section id="content" class="body">
                    <h1>Other articles</h1>
                    <hr />
                    <ol id="posts-list" class="hfeed">

            <li><article class="hentry">
                <header>
                    <h1><a href="https://blog.weininger.net/streaming-video-files-to-samsung-tvs-part-1.html" rel="bookmark"
                           title="Permalink to Streaming video files to Samsung TVs (Part 1)">Streaming video files to Samsung TVs (Part 1)</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2012-05-12T18:31:00+02:00">
                Published: Sa 12 Mai 2012
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://blog.weininger.net/author/thomas-weininger.html">Thomas Weininger</a>
        </address>
<p>In <a href="https://blog.weininger.net/category/free-software.html">Free Software</a>.</p>
<p>tags: <a href="https://blog.weininger.net/tag/dlna.html">DLNA</a> <a href="https://blog.weininger.net/tag/linux.html">Linux</a> <a href="https://blog.weininger.net/tag/nas.html">NAS</a> <a href="https://blog.weininger.net/tag/samsung-tv.html">Samsung TV</a> <a href="https://blog.weininger.net/tag/serviio.html">Serviio</a> </p>
</footer><!-- /.post-info -->                <p><a class="reference external image-reference" href="http://blog.weinimo.de/wp-content/uploads/2012/05/logo1.png"><img alt="image0" src="http://blog.weinimo.de/wp-content/uploads/2012/05/logo1-300x79.png" /></a></p>
<p>I have a huge video archive on my NAS and I wanted to be able to stream
the files to my Samsung TV UE40D6300 using its DLNA capability. Because
TVs in general and the DLNA standard especially do not support many
codecs it was clear to me that this goal …</p>
                <a class="readmore" href="https://blog.weininger.net/streaming-video-files-to-samsung-tvs-part-1.html">read more</a>
<p>There are <a href="https://blog.weininger.net/streaming-video-files-to-samsung-tvs-part-1.html#disqus_thread">comments</a>.</p>                </div><!-- /.entry-content -->
            </article></li>
                </ol><!-- /#posts-list -->
                </section><!-- /#content -->
        <section id="extras" class="body">
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="https://github.com/weinimo">github</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a rel="nofollow" href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a rel="nofollow" href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

<script type="text/javascript">
    var disqus_shortname = 'weiningernet';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'https://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>
</html>